name: iOS CI

on:
  pull_request:
    branches:
      - main
    paths:
      - 'iosApp/**'
      - '.github/workflows/ios-ci.yml'

jobs:
  test:
    runs-on: macos-15

    steps:
    - name: Checkout code
      uses: actions/checkout@eef61447b9ff4aafe5dcd4e0bbf5d482be7e7871 # v4.2.1

    - name: Set up Ruby
      uses: ruby/setup-ruby@7bae1d00b5db9166f4f0fc47985a3a5702cb58f0 # v1.227.0
      with:
        ruby-version: '3.3'
        bundler-cache: false

    - name: Install fastlane
      run: gem install fastlane

    - name: Create Secrets.swift
      run: |
        cat > iosApp/deadly/App/Secrets.swift << 'SWIFT'
        enum Secrets {
            static let geniusAccessToken = ""
        }
        SWIFT

    - name: Run tests
      run: |
        cd iosApp
        fastlane test
